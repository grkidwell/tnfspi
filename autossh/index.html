<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.com/autossh/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Autossh - RPI TNFS Server</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">RPI TNFS Server</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../digocean/" class="nav-link">Digital Ocean</a>
                            </li>
                            <li class="navitem">
                                <a href="../ubuntu/" class="nav-link">Ubuntu Pi Image</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Autossh</a>
                            </li>
                            <li class="navitem">
                                <a href="../wireguard/" class="nav-link">Wireguard</a>
                            </li>
                            <li class="navitem">
                                <a href="../zfs/" class="nav-link">ZFS</a>
                            </li>
                            <li class="navitem">
                                <a href="../tnfs/" class="nav-link">TNFS</a>
                            </li>
                            <li class="navitem">
                                <a href="../ap/" class="nav-link">AP</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ubuntu/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../wireguard/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#autossh" class="nav-link">Autossh</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link">&nbsp;</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#copy-sshkeys" class="nav-link">Copy sshkeys</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#test-ssh-function" class="nav-link">Test ssh function</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_4" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_5" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_6" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#install-autossh" class="nav-link">Install Autossh</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_7" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_8" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#test-reverse-ssh-tunnel" class="nav-link">Test reverse ssh tunnel</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_9" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="autossh">Autossh</h1>
<h1 id="_1">&nbsp;</h1>
<p>Create a "back door" reverse ssh tunnel between tnfspi and digital ocean server.
The tunnel is initiated/created from the raspberry pi, but is accessed from the digocean server.
This tunnel will allow your pc to use the digocean server as a "jump point" to the raspberry pi tnfspi server
inside your home firewall.  Because the reverse ssh tunnel is created from tnfspi, you don't have to open 
pinholes in your home firewall to access it from the outside.</p>
<h2 id="copy-sshkeys">Copy sshkeys</h2>
<p>from linux pc to tnfspi</p>
<h2 id="_2"></h2>
<pre><code>alex@xanadu_pc:~$ sudo scp .ssh/tnfs* pi@tnfspi.local:~/.ssh
</code></pre>
<p>Login to tnfspi </p>
<h2 id="_3"></h2>
<pre><code>alex@xanadu_pc:~$ ssh pi@tnfspi.local     # pi will ask for password
pi@tnfspi:~$
</code></pre>
<h2 id="test-ssh-function">Test ssh function</h2>
<p>from tnfspi to digocean server</p>
<h2 id="_4"></h2>
<pre><code>pi@tnfspi:~$ ssh -i ~/.ssh/tnfs geddy@211.211.211.211
</code></pre>
<p>This should log you into digital ocean server.  </p>
<h2 id="_5"></h2>
<pre><code>geddy@211.211.211.211:~$
</code></pre>
<p>Now exit back to tnfspi</p>
<h2 id="_6"></h2>
<pre><code>geddy@211.211.211.211:~$ exit
</code></pre>
<h2 id="install-autossh">Install Autossh</h2>
<p>on Rpi</p>
<h2 id="_7"></h2>
<pre><code>pi@tnfspi:~$ sudo apt install autossh
pi@tnfspi:~$ sudo nano /lib/systemd/system/autossh-digocean-tunnel.service

#this service establishes a reverse tunnel with the digital ocean server
#

[Unit]
Description=AutoSSH tunnel service digital ocean 211.211.211.211 on local port 2222
Wants=network-online.target
After=network-online.target

[Service]
Type=simple
User=pi
Environment="AUTOSSH_GATETIME=0"
ExecStart=
ExecStart=/usr/bin/autossh -M 0 -o "ExitOnForwardFailure yes" -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" -N -R 2222:localhost:22 geddy@211.211.211.211 -i /home/pi/.ssh/tnfs

[Install]
WantedBy=multi-user.target
</code></pre>
<h2 id="_8"></h2>
<pre><code>pi@tnfspi:~$ sudo systemctl daemon-reload
pi@tnfspi:~$ sudo systemctl enable autossh-digocean-tunnel
pi@tnfspi:~$ sudo systemctl start autossh-digocean-tunnel
</code></pre>
<h2 id="test-reverse-ssh-tunnel">Test reverse ssh tunnel</h2>
<p>From linux pc to digocean server to tnfs pi server</p>
<h2 id="_9"></h2>
<pre><code>alex@xanadu_pc:~$ ssh tnfs
geddy@tnfs_digocean:~$ ssh -p 2222 pi@localhost
pi@tnfspi:~$
</code></pre>
<p>You now are logged into your raspberry pi inside your home network!</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
