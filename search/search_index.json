{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to TFNSpi For repository of these instructions see github tnfspi Components Digital Ocean server as central hub of wireguard network Ubuntu Server on Raspberry Pi Autossh reverse ssh tunnel between raspberry pi and digital ocean server for maintenance. Wireguard to create secure encrypted VPN tunnel between multiple TNFS servers /Fujinet devices ZFS filesystem and Sanoid to automate rolling snapshots of tnfs data TNFS to share Atari disk images over Fujinet Samba to easily transfer files over both local network and wireguard vpn Network Manager to easily turn the pi into an access point to wirelessly communicate with Fujinet device Architecture","title":"Home"},{"location":"#welcome-to-tfnspi","text":"For repository of these instructions see github tnfspi","title":"Welcome to TFNSpi"},{"location":"#components","text":"Digital Ocean server as central hub of wireguard network Ubuntu Server on Raspberry Pi Autossh reverse ssh tunnel between raspberry pi and digital ocean server for maintenance. Wireguard to create secure encrypted VPN tunnel between multiple TNFS servers /Fujinet devices ZFS filesystem and Sanoid to automate rolling snapshots of tnfs data TNFS to share Atari disk images over Fujinet Samba to easily transfer files over both local network and wireguard vpn Network Manager to easily turn the pi into an access point to wirelessly communicate with Fujinet device","title":"Components"},{"location":"#architecture","text":"","title":"Architecture"},{"location":"about/","text":"Ab veteris sanguis non toto fide aestu Saxo inlatum ater quae adamanta opemque sum Lorem markdownum superabat leve alimenta habuere linguam. Antiquum tot laudat si nec dubites vestra teque quicquam reducto: de ad. Volucresque undis, erat tibi rupisset astra: oblectamina cibos, cum iugo sol. edutainment_peopleware_megapixel += mainframe; if (installerShareware(windows_jsp, impactDuplexName / 2, ppl)) { soft_truncate_cron = trinitron_illegal; } exifClientPython = piconetCcDevelopment(jumper * bluetoothScsi - 97 - processor_boolean_widget, so_system_gbps, unicodePmuDrm.gammaBarcraftApplet(-3, 4)); Respicit urbem iter lepores sic Circaeo hoc clausaeque fuit inveniebantur memini tigno damnum formatae legit. Suo amoris animos armenti imoque, qua medio conclamat tempora partem ad a undis adiacet nutantia. In abibas pollice tecta hoc! Flumina Aeson perfida Aphareia simul; ait ferre clausit triplices sunt. Tuta dixit versatus serpens in crimine Cadmus. In nullos dedit. Feci parabat semel flectitur verbis palmae, cum pacis, una. Partem nympha eripui Suo nomen mutati sine es submissaeque novique genetrix spectabat onus; exigit phoenica Pelasgae mecum; trux flexit . Fugavi fixus adultera in modo recepi vulneribus cibique cubat, artis vidit, ictu solet committere sparsit! Nolet sunt ut sustinuit, diro arida invenio, corpora fateor; aniles bene si oracula raro. Mediis flumine leones. Primo ullis ut quondam solibus: in genibus obest exstimulata freta ubi. Ipso tamen ite lumine Iovis nutritaque fieri His quidem mora quid, bracchiaque vocabat an incidit quique, si. Thalamos sorores periuria emissi. Ulixem dolore ligat tactusque fata , factae Nonacrina premunt, mihi. Ad genus solitas superos celas dedit imitantia sequitur. Ea omne intellege molire eras in totas. Poma cava bene? Solent euntis, simulacraque illis, animam Aeaeae ausum, gaudia? Deorum coeamus ab spemque hospes: plurima, abdita virgas. Actaeis sacerdos missa; amicos auxilium forte; venter Iove Phoebique. Et cum aegre?","title":"Ab veteris sanguis non toto fide aestu"},{"location":"about/#ab-veteris-sanguis-non-toto-fide-aestu","text":"","title":"Ab veteris sanguis non toto fide aestu"},{"location":"about/#saxo-inlatum-ater-quae-adamanta-opemque-sum","text":"Lorem markdownum superabat leve alimenta habuere linguam. Antiquum tot laudat si nec dubites vestra teque quicquam reducto: de ad. Volucresque undis, erat tibi rupisset astra: oblectamina cibos, cum iugo sol. edutainment_peopleware_megapixel += mainframe; if (installerShareware(windows_jsp, impactDuplexName / 2, ppl)) { soft_truncate_cron = trinitron_illegal; } exifClientPython = piconetCcDevelopment(jumper * bluetoothScsi - 97 - processor_boolean_widget, so_system_gbps, unicodePmuDrm.gammaBarcraftApplet(-3, 4));","title":"Saxo inlatum ater quae adamanta opemque sum"},{"location":"about/#respicit-urbem-iter-lepores-sic","text":"Circaeo hoc clausaeque fuit inveniebantur memini tigno damnum formatae legit. Suo amoris animos armenti imoque, qua medio conclamat tempora partem ad a undis adiacet nutantia. In abibas pollice tecta hoc! Flumina Aeson perfida Aphareia simul; ait ferre clausit triplices sunt. Tuta dixit versatus serpens in crimine Cadmus. In nullos dedit. Feci parabat semel flectitur verbis palmae, cum pacis, una.","title":"Respicit urbem iter lepores sic"},{"location":"about/#partem-nympha-eripui","text":"Suo nomen mutati sine es submissaeque novique genetrix spectabat onus; exigit phoenica Pelasgae mecum; trux flexit . Fugavi fixus adultera in modo recepi vulneribus cibique cubat, artis vidit, ictu solet committere sparsit! Nolet sunt ut sustinuit, diro arida invenio, corpora fateor; aniles bene si oracula raro. Mediis flumine leones. Primo ullis ut quondam solibus: in genibus obest exstimulata freta ubi.","title":"Partem nympha eripui"},{"location":"about/#ipso-tamen-ite-lumine-iovis-nutritaque-fieri","text":"His quidem mora quid, bracchiaque vocabat an incidit quique, si. Thalamos sorores periuria emissi. Ulixem dolore ligat tactusque fata , factae Nonacrina premunt, mihi. Ad genus solitas superos celas dedit imitantia sequitur. Ea omne intellege molire eras in totas. Poma cava bene? Solent euntis, simulacraque illis, animam Aeaeae ausum, gaudia? Deorum coeamus ab spemque hospes: plurima, abdita virgas. Actaeis sacerdos missa; amicos auxilium forte; venter Iove Phoebique. Et cum aegre?","title":"Ipso tamen ite lumine Iovis nutritaque fieri"},{"location":"ap/","text":"Access Point Install Network Manager pi@tnfspi:~$ sudo apt install network-manager Create Hotspot pi@tnfspi:~$ sudo nmcli d wifi hotspot ifname wlan0 ssid tnfspi password strangiato Configure and Activate Hotspot pi@tnfspi:~$ sudo nmcli con modify Hotspot ipv4.method shared ipv4.addresses 192.168.6.1/24 pi@tnfspi:~$ sudo nmcli con mod Hotspot connection.autoconnect yes pi@tnfspi:~$ sudo nmcli con up Hotspot This page under construction","title":"AP"},{"location":"ap/#access-point","text":"","title":"Access Point"},{"location":"ap/#_1","text":"","title":"&nbsp;"},{"location":"ap/#install-network-manager","text":"pi@tnfspi:~$ sudo apt install network-manager","title":"Install Network Manager"},{"location":"ap/#create-hotspot","text":"pi@tnfspi:~$ sudo nmcli d wifi hotspot ifname wlan0 ssid tnfspi password strangiato","title":"Create Hotspot"},{"location":"ap/#configure-and-activate-hotspot","text":"pi@tnfspi:~$ sudo nmcli con modify Hotspot ipv4.method shared ipv4.addresses 192.168.6.1/24 pi@tnfspi:~$ sudo nmcli con mod Hotspot connection.autoconnect yes pi@tnfspi:~$ sudo nmcli con up Hotspot This page under construction","title":"Configure and Activate Hotspot"},{"location":"autossh/","text":"Autossh Create a \"back door\" reverse ssh tunnel between tnfspi and digital ocean server. The tunnel is initiated/created from the raspberry pi, but is accessed from the digocean server. This tunnel will allow your pc to use the digocean server as a \"jump point\" to the raspberry pi tnfspi server inside your home firewall. Because the reverse ssh tunnel is created from tnfspi, you don't have to open pinholes in your home firewall to access it from the outside. Copy sshkeys from linux pc to tnfspi alex@xanadu_pc:~$ sudo scp .ssh/tnfs* pi@tnfspi.local:~/.ssh Login to tnfspi alex@xanadu_pc:~$ ssh pi@tnfspi.local # pi will ask for password pi@tnfspi:~$ Test ssh function from tnfspi to digocean server pi@tnfspi:~$ ssh -i ~/.ssh/tnfs geddy@211.211.211.211 This should log you into digital ocean server. geddy@211.211.211.211:~$ Now exit back to tnfspi geddy@211.211.211.211:~$ exit Install Autossh on Rpi pi@tnfspi:~$ sudo apt install autossh pi@tnfspi:~$ sudo nano /lib/systemd/system/autossh-digocean-tunnel.service #this service establishes a reverse tunnel with the digital ocean server # [Unit] Description=AutoSSH tunnel service digital ocean 211.211.211.211 on local port 2222 Wants=network-online.target After=network-online.target [Service] Type=simple User=pi Environment=\"AUTOSSH_GATETIME=0\" ExecStart= ExecStart=/usr/bin/autossh -M 0 -o \"ExitOnForwardFailure yes\" -o \"ServerAliveInterval 30\" -o \"ServerAliveCountMax 3\" -N -R 2222:localhost:22 geddy@211.211.211.211 -i /home/pi/.ssh/tnfs [Install] WantedBy=multi-user.target pi@tnfspi:~$ sudo systemctl daemon-reload pi@tnfspi:~$ sudo systemctl enable autossh-digocean-tunnel pi@tnfspi:~$ sudo systemctl start autossh-digocean-tunnel Test reverse ssh tunnel From linux pc to digocean server to tnfs pi server alex@xanadu_pc:~$ ssh tnfs geddy@tnfs_digocean:~$ ssh -p 2222 pi@localhost pi@tnfspi:~$ You now are logged into your raspberry pi inside your home network!","title":"Autossh"},{"location":"autossh/#autossh","text":"","title":"Autossh"},{"location":"autossh/#_1","text":"Create a \"back door\" reverse ssh tunnel between tnfspi and digital ocean server. The tunnel is initiated/created from the raspberry pi, but is accessed from the digocean server. This tunnel will allow your pc to use the digocean server as a \"jump point\" to the raspberry pi tnfspi server inside your home firewall. Because the reverse ssh tunnel is created from tnfspi, you don't have to open pinholes in your home firewall to access it from the outside.","title":"&nbsp;"},{"location":"autossh/#copy-sshkeys","text":"from linux pc to tnfspi","title":"Copy sshkeys"},{"location":"autossh/#_2","text":"alex@xanadu_pc:~$ sudo scp .ssh/tnfs* pi@tnfspi.local:~/.ssh Login to tnfspi","title":""},{"location":"autossh/#_3","text":"alex@xanadu_pc:~$ ssh pi@tnfspi.local # pi will ask for password pi@tnfspi:~$","title":""},{"location":"autossh/#test-ssh-function","text":"from tnfspi to digocean server","title":"Test ssh function"},{"location":"autossh/#_4","text":"pi@tnfspi:~$ ssh -i ~/.ssh/tnfs geddy@211.211.211.211 This should log you into digital ocean server.","title":""},{"location":"autossh/#_5","text":"geddy@211.211.211.211:~$ Now exit back to tnfspi","title":""},{"location":"autossh/#_6","text":"geddy@211.211.211.211:~$ exit","title":""},{"location":"autossh/#install-autossh","text":"on Rpi","title":"Install Autossh"},{"location":"autossh/#_7","text":"pi@tnfspi:~$ sudo apt install autossh pi@tnfspi:~$ sudo nano /lib/systemd/system/autossh-digocean-tunnel.service #this service establishes a reverse tunnel with the digital ocean server # [Unit] Description=AutoSSH tunnel service digital ocean 211.211.211.211 on local port 2222 Wants=network-online.target After=network-online.target [Service] Type=simple User=pi Environment=\"AUTOSSH_GATETIME=0\" ExecStart= ExecStart=/usr/bin/autossh -M 0 -o \"ExitOnForwardFailure yes\" -o \"ServerAliveInterval 30\" -o \"ServerAliveCountMax 3\" -N -R 2222:localhost:22 geddy@211.211.211.211 -i /home/pi/.ssh/tnfs [Install] WantedBy=multi-user.target","title":""},{"location":"autossh/#_8","text":"pi@tnfspi:~$ sudo systemctl daemon-reload pi@tnfspi:~$ sudo systemctl enable autossh-digocean-tunnel pi@tnfspi:~$ sudo systemctl start autossh-digocean-tunnel","title":""},{"location":"autossh/#test-reverse-ssh-tunnel","text":"From linux pc to digocean server to tnfs pi server","title":"Test reverse ssh tunnel"},{"location":"autossh/#_9","text":"alex@xanadu_pc:~$ ssh tnfs geddy@tnfs_digocean:~$ ssh -p 2222 pi@localhost pi@tnfspi:~$ You now are logged into your raspberry pi inside your home network!","title":""},{"location":"digocean/","text":"Set up a Digital Ocean server Create a new account with $100/60-day credit on Digital Ocean , who sponsors the excellent PythonBytes podcast. Create a new droplet Choose Ubuntu 20.04(LTS)x64 Distribution Select Regular Intel w/SSD for $5/month Create password Authentication. Do not create New SSH key. You will do this from your linux client. Click green bar Create Droplet Initial Server Setup Follow digital ocean Initial Setup tutorial From linux pc client alex@xanadu_pc:~$ ssh root@211.211.211.211 # Enter your new static IP address provided by Digital Ocean Now you are logged in to your digital ocean server as root From UFW Essentials Guide root@tnfs_digocean:$ adduser geddy #may need to be useradd root@tnfs_digocean:$ usermod -aG sudo geddy root@tnfs_digocean:$ ufw allow OpenSSH root@tnfs_digocean:$ ufw enable Exit back to linux pc root@tnfs_digocean:$ exit alex@xanadu_pc:~$ Create ssh key pair on linux PC client and copy to server from SSH Key Creation tutorial alex@xanadu_pc:~$ cd .ssh alex@xanadu_pc:~/.ssh$ ssh-keygen # enter tnfs when prompted alex@xanadu_pc:~/.ssh$ ssh-copy-id -i tnfs.pub geddy@211.211.211.211 Setup ~/.ssh/config on client PC alex@xanadu_pc:~/.ssh$ nano config Host tnfs* HostName 211.211.211.211 User geddy IdentityFile ~/.ssh/tnfs alex@xanadu_pc:~/.ssh$ ssh tnfs # now you have a shortcut to ssh from client into DO server geddy@tnfs_digocean:~$ Disable Password Access on server geddy@tnfs_digocean:~$ sudo nano /etc/ssh/sshd_config PasswordAuthentication no # then cntl-x and save geddy@tnfs_digocean:~$ sudo service ssh restart","title":"Digital Ocean"},{"location":"digocean/#set-up-a-digital-ocean-server","text":"","title":"Set up a Digital Ocean server"},{"location":"digocean/#_1","text":"Create a new account with $100/60-day credit on Digital Ocean , who sponsors the excellent PythonBytes podcast.","title":"&nbsp;"},{"location":"digocean/#create-a-new-droplet","text":"Choose Ubuntu 20.04(LTS)x64 Distribution Select Regular Intel w/SSD for $5/month Create password Authentication. Do not create New SSH key. You will do this from your linux client. Click green bar Create Droplet","title":"Create a new droplet"},{"location":"digocean/#initial-server-setup","text":"Follow digital ocean Initial Setup tutorial From linux pc client alex@xanadu_pc:~$ ssh root@211.211.211.211 # Enter your new static IP address provided by Digital Ocean Now you are logged in to your digital ocean server as root From UFW Essentials Guide root@tnfs_digocean:$ adduser geddy #may need to be useradd root@tnfs_digocean:$ usermod -aG sudo geddy root@tnfs_digocean:$ ufw allow OpenSSH root@tnfs_digocean:$ ufw enable Exit back to linux pc","title":"Initial Server Setup"},{"location":"digocean/#_2","text":"root@tnfs_digocean:$ exit alex@xanadu_pc:~$","title":""},{"location":"digocean/#create-ssh-key-pair","text":"on linux PC client and copy to server from SSH Key Creation tutorial","title":"Create ssh key pair"},{"location":"digocean/#_3","text":"alex@xanadu_pc:~$ cd .ssh alex@xanadu_pc:~/.ssh$ ssh-keygen # enter tnfs when prompted alex@xanadu_pc:~/.ssh$ ssh-copy-id -i tnfs.pub geddy@211.211.211.211","title":""},{"location":"digocean/#setup-sshconfig","text":"on client PC","title":"Setup ~/.ssh/config"},{"location":"digocean/#_4","text":"alex@xanadu_pc:~/.ssh$ nano config Host tnfs* HostName 211.211.211.211 User geddy IdentityFile ~/.ssh/tnfs alex@xanadu_pc:~/.ssh$ ssh tnfs # now you have a shortcut to ssh from client into DO server geddy@tnfs_digocean:~$","title":""},{"location":"digocean/#disable-password-access","text":"on server","title":"Disable Password Access"},{"location":"digocean/#_5","text":"geddy@tnfs_digocean:~$ sudo nano /etc/ssh/sshd_config PasswordAuthentication no # then cntl-x and save geddy@tnfs_digocean:~$ sudo service ssh restart","title":""},{"location":"tnfs/","text":"TNFS Ref Setting up TNFS on a Raspberry Pi Install packages pi@tnfspi:~$ sudo apt install samba samba-common-bin make build-essential pi@tnfspi:~$ git clone https://github.com/FujiNetWIFI/spectranet.git cd spectranet cd tnfs/tnfsd make OS=LINUX DEBUG=Y sudo cp bin/tnfsd /usr/local/sbin sudo chown tnfs:tnfs /bytor/tnfs Create tnfs systemd service pi@tnfspi:~$ sudo nano /etc/systemd/system/tnfsd.service [Unit] Description=TNFS Server After=remote-fs.target After=syslog.target [Service] User=tnfs Group=tnfs ExecStart=/usr/local/sbin/tnfsd /bytor/tnfs [Install] WantedBy=multi-user.target Edit samba config file pi@tnfspi:~$ sudo nano /etc/samba/smb.conf Add to bottom [tnfs] path = /bytor/tnfs writeable = Yes create mask = 0777 directory mask = 0777 public = yes force user = tnfs force group = tnfs Reload systemd pi@tnfspi:~$ sudo systemctl daemon-reload pi@tnfspi:~$ sudo systemctl enable tnfsd pi@tnfspi:~$ sudo systemctl start tnfsd pi@tnfspi:~$ sudo systemctl restart smbd This page under construction","title":"TNFS"},{"location":"tnfs/#tnfs","text":"","title":"TNFS"},{"location":"tnfs/#_1","text":"Ref Setting up TNFS on a Raspberry Pi","title":"&nbsp;"},{"location":"tnfs/#install-packages","text":"pi@tnfspi:~$ sudo apt install samba samba-common-bin make build-essential pi@tnfspi:~$ git clone https://github.com/FujiNetWIFI/spectranet.git cd spectranet cd tnfs/tnfsd make OS=LINUX DEBUG=Y sudo cp bin/tnfsd /usr/local/sbin sudo chown tnfs:tnfs /bytor/tnfs","title":"Install packages"},{"location":"tnfs/#create-tnfs-systemd-service","text":"pi@tnfspi:~$ sudo nano /etc/systemd/system/tnfsd.service [Unit] Description=TNFS Server After=remote-fs.target After=syslog.target [Service] User=tnfs Group=tnfs ExecStart=/usr/local/sbin/tnfsd /bytor/tnfs [Install] WantedBy=multi-user.target","title":"Create tnfs systemd service"},{"location":"tnfs/#edit-samba-config-file","text":"pi@tnfspi:~$ sudo nano /etc/samba/smb.conf Add to bottom [tnfs] path = /bytor/tnfs writeable = Yes create mask = 0777 directory mask = 0777 public = yes force user = tnfs force group = tnfs","title":"Edit samba config file"},{"location":"tnfs/#reload-systemd","text":"pi@tnfspi:~$ sudo systemctl daemon-reload pi@tnfspi:~$ sudo systemctl enable tnfsd pi@tnfspi:~$ sudo systemctl start tnfsd pi@tnfspi:~$ sudo systemctl restart smbd This page under construction","title":"Reload systemd"},{"location":"ubuntu/","text":"Install Ubuntu Server image on Raspberry Pi Image USB drive Use Raspberry Pi Imager link to download Raspberry pi imager select \"Other general purpose OS\" select \"Ubuntu\" select \"Ubuntu Server 21.10 (RPI2/3/4/400) 64bit(zfs) or 32bit(no zfs) Partition USB drive Use Gparted to resize OS partition and add zdata partition Boot Rpi and Check FW Reference link Rpi4 Bootloader Firmware Update Guide ubuntu@ubuntu:~$ sudo apt update && sudo apt upgrade -Y ubuntu@ubuntu:~$ sudo reboot ubuntu@ubuntu:~$ sudo rpi-eeprom-update If FW is not up to date then run ubuntu@ubuntu:~$ sudo rpi-eeprom-update -d -a Add pi user ubuntu@ubuntu:~$ sudo adduser pi ubuntu@ubuntu:~$ sudo usermod -aG sudo pi Add local name resolving and change hostname ubuntu@ubuntu:~$ sudo apt install libnss-mdns ubuntu@ubuntu:~$ sudo nano /etc/nsswitch.conf hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4 ubuntu@ubuntu:~$ sudo hostnamectl set-hostname tnfspi ubuntu@ubuntu:~$ sudo reboot alex@xanadu_pc:~$ Remote ssh login from PC terminal to user pi at tnfspi server alex@xanadu_pc:~$ ssh pi@tnfspi.local pi@tnfspi:~$","title":"Ubuntu Pi Image"},{"location":"ubuntu/#install-ubuntu-server-image","text":"on Raspberry Pi","title":"Install Ubuntu Server image"},{"location":"ubuntu/#_1","text":"","title":"&nbsp;"},{"location":"ubuntu/#image-usb-drive","text":"Use Raspberry Pi Imager link to download Raspberry pi imager select \"Other general purpose OS\" select \"Ubuntu\" select \"Ubuntu Server 21.10 (RPI2/3/4/400) 64bit(zfs) or 32bit(no zfs)","title":"Image USB drive"},{"location":"ubuntu/#partition-usb-drive","text":"Use Gparted to resize OS partition and add zdata partition","title":"Partition USB drive"},{"location":"ubuntu/#boot-rpi-and-check-fw","text":"Reference link Rpi4 Bootloader Firmware Update Guide ubuntu@ubuntu:~$ sudo apt update && sudo apt upgrade -Y ubuntu@ubuntu:~$ sudo reboot ubuntu@ubuntu:~$ sudo rpi-eeprom-update If FW is not up to date then run","title":"Boot Rpi and Check FW"},{"location":"ubuntu/#_2","text":"ubuntu@ubuntu:~$ sudo rpi-eeprom-update -d -a","title":""},{"location":"ubuntu/#add-pi-user","text":"ubuntu@ubuntu:~$ sudo adduser pi ubuntu@ubuntu:~$ sudo usermod -aG sudo pi","title":"Add pi user"},{"location":"ubuntu/#add-local-name-resolving","text":"and change hostname","title":"Add local name resolving"},{"location":"ubuntu/#_3","text":"ubuntu@ubuntu:~$ sudo apt install libnss-mdns ubuntu@ubuntu:~$ sudo nano /etc/nsswitch.conf hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4 ubuntu@ubuntu:~$ sudo hostnamectl set-hostname tnfspi ubuntu@ubuntu:~$ sudo reboot alex@xanadu_pc:~$","title":""},{"location":"ubuntu/#remote-ssh-login","text":"from PC terminal to user pi at tnfspi server","title":"Remote ssh login"},{"location":"ubuntu/#_4","text":"alex@xanadu_pc:~$ ssh pi@tnfspi.local pi@tnfspi:~$","title":""},{"location":"wireguard/","text":"Wireguard Install wireguard digital ocean server geddy@tnfs_digocean:~$ sudo apt install wireguard tnfspi pi@tnfspi~$ sudo apt install wireguard Generate key-pairs digital ocean server geddy@tnfs_digocean:~$ wg genkey |sudo tee private.key geddy@tnfs_digocean:~$ cat private.key|wg pubkey|sudo tee public.key tnfspi pi@tnfspi:~$ wg genkey |sudo tee private.key pi@tnfspi:~$ cat private.key|wg pubkey|sudo tee public.key Create wireguard config files digital ocean server geddy@tnfs_digocean:~$ sudo nano /etc/wireguard/wgtnfs.conf [interface] PrivateKey = <tnfs_digocean private key> Address = 10.14.1.1/24 ListenPort=51820 PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE #tnfspi [Peer] Publickey= <tnfspi public key> AllowedIPs=10.14.1.2/32 tnfspi pi@tnfspi:~$ sudo nano /etc/wireguard/wgtnfs.conf [Interface] Privatekey = <tnfspi privatekey> Address = 10.14.1.2/24 [Peer] Publickey = <tnfs_digocean private key> Endpoint = <tnfs_digocean status ip address>:51820 AllowedIPs = 10.14.1.0/24 PersistentKeepalive = 25 Enable port forwarding digital ocean server geddy@tnfs_digocean:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 geddy@tnfs_digocean:~$ sudo sysctl -p /etc/sysctl.conf # restart service geddy@tnfs_digocean:~$ sysctl net.ipv4.ip_forward # verifies ip forwarding is enabled. should return net.ipv4.ip_foward=1 tnfspi pi@tnfspi:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 pi@tnfspi:~$ sudo sysctl -p /etc/sysctl.conf # restart service pi@tnfspi:~$ sysctl net.ipv4.ip_forward # verifies ip forwarding is enabled. should return net.ipv4.ip_foward=1 Open server port 51820 geddy@tnfs_digocean:~$ sudo ufw allow 51820 Start Wireguard digital ocean server geddy@tnfs_digocean:~$ sudo systemctl start wg-quick@wgtnfs.service geddy@tnfs_digocean:~$ sudo systemctl enable wg-quick@wgtnfs.service tnfspi pi@tnfspi:~$ sudo systemctl start wg-quick@wgtnfs.service pi@tnfspi:~$ sudo systemctl enable wg-quick@wgtnfs.service Login to server from client pi@tnfspi:~$ ssh -i .ssh/tnfs geddy@10.14.1.1 geddy@tnfs_digocean:~$ Login to client from server geddy@tnfs_digocean:~$ ssh pi@10.14.1.2 pi@tnfspi:~$","title":"Wireguard"},{"location":"wireguard/#wireguard","text":"","title":"Wireguard"},{"location":"wireguard/#_1","text":"","title":"&nbsp;"},{"location":"wireguard/#install-wireguard","text":"digital ocean server","title":"Install wireguard"},{"location":"wireguard/#_2","text":"geddy@tnfs_digocean:~$ sudo apt install wireguard tnfspi","title":""},{"location":"wireguard/#_3","text":"pi@tnfspi~$ sudo apt install wireguard","title":""},{"location":"wireguard/#generate-key-pairs","text":"digital ocean server","title":"Generate key-pairs"},{"location":"wireguard/#_4","text":"geddy@tnfs_digocean:~$ wg genkey |sudo tee private.key geddy@tnfs_digocean:~$ cat private.key|wg pubkey|sudo tee public.key tnfspi","title":""},{"location":"wireguard/#_5","text":"pi@tnfspi:~$ wg genkey |sudo tee private.key pi@tnfspi:~$ cat private.key|wg pubkey|sudo tee public.key","title":""},{"location":"wireguard/#create-wireguard-config-files","text":"digital ocean server","title":"Create wireguard config files"},{"location":"wireguard/#_6","text":"geddy@tnfs_digocean:~$ sudo nano /etc/wireguard/wgtnfs.conf [interface] PrivateKey = <tnfs_digocean private key> Address = 10.14.1.1/24 ListenPort=51820 PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE #tnfspi [Peer] Publickey= <tnfspi public key> AllowedIPs=10.14.1.2/32 tnfspi","title":""},{"location":"wireguard/#_7","text":"pi@tnfspi:~$ sudo nano /etc/wireguard/wgtnfs.conf [Interface] Privatekey = <tnfspi privatekey> Address = 10.14.1.2/24 [Peer] Publickey = <tnfs_digocean private key> Endpoint = <tnfs_digocean status ip address>:51820 AllowedIPs = 10.14.1.0/24 PersistentKeepalive = 25","title":""},{"location":"wireguard/#enable-port-forwarding","text":"digital ocean server","title":"Enable port forwarding"},{"location":"wireguard/#_8","text":"geddy@tnfs_digocean:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 geddy@tnfs_digocean:~$ sudo sysctl -p /etc/sysctl.conf # restart service geddy@tnfs_digocean:~$ sysctl net.ipv4.ip_forward # verifies ip forwarding is enabled. should return net.ipv4.ip_foward=1 tnfspi","title":""},{"location":"wireguard/#_9","text":"pi@tnfspi:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 pi@tnfspi:~$ sudo sysctl -p /etc/sysctl.conf # restart service pi@tnfspi:~$ sysctl net.ipv4.ip_forward # verifies ip forwarding is enabled. should return net.ipv4.ip_foward=1","title":""},{"location":"wireguard/#open-server-port-51820","text":"geddy@tnfs_digocean:~$ sudo ufw allow 51820","title":"Open server port 51820"},{"location":"wireguard/#start-wireguard","text":"digital ocean server","title":"Start Wireguard"},{"location":"wireguard/#_10","text":"geddy@tnfs_digocean:~$ sudo systemctl start wg-quick@wgtnfs.service geddy@tnfs_digocean:~$ sudo systemctl enable wg-quick@wgtnfs.service tnfspi","title":""},{"location":"wireguard/#_11","text":"pi@tnfspi:~$ sudo systemctl start wg-quick@wgtnfs.service pi@tnfspi:~$ sudo systemctl enable wg-quick@wgtnfs.service","title":""},{"location":"wireguard/#login-to-server-from-client","text":"pi@tnfspi:~$ ssh -i .ssh/tnfs geddy@10.14.1.1 geddy@tnfs_digocean:~$","title":"Login to server from client"},{"location":"wireguard/#login-to-client-from-server","text":"geddy@tnfs_digocean:~$ ssh pi@10.14.1.2 pi@tnfspi:~$","title":"Login to client from server"},{"location":"zfs/","text":"ZFS Installation of the ZFS filesystem is optional and requires the Ubuntu 64bit operating system. Install zfsutils-linux pi@tnfspi:~$ sudo apt install zfsutils-linux Create zpool on zdata partition pi@tnfspi:~$ sudo zpool create bytor -f -d /dev/disk/by-label/zdata pi@tnfspi:~$ sudo zpool upgrade bytor Create tnfs zfs dataset pi@tnfspi:~$ sudo zfs create -o atime=off -o compression=lz4 -o recordsize=1k bytor/tnfs limit zfs memory cache to 1GB pi@tnfspi:~$ sudo echo \"options zfs zfs_arc_max=1073741824\"|sudo tee -a /etc/modprobe.d/zfs.conf Install sanoid pi@tnfspi:~$ sudo apt install sanoid pi@tnfspi:~$ sudo mkdir /etc/sanoid pi@tnfspi:~$ sudo cp /usr/share/doc/sanoid/examples/sanoid.conf /etc/sanoid/sanoid.conf Edit sanoid config file pi@tnfspi:~$ sudo nano /etc/sanoid/sanoid.conf Comment out all examples, add single entry for bytor/tnfs Modify template_production frequently=10 and yearly=3 ###################################### # This is a sample sanoid.conf file. # # It should go in /etc/sanoid. # ###################################### # name your backup modules with the path to their ZFS dataset - no leading slash. #[zpoolname/datasetname] # pick one or more templates - they're defined (and editable) below. Comma separated, processed in order. # in this example, template_demo's daily value overrides template_production's daily value. # use_template = production,demo # if you want to, you can override settings in the template directly inside module definitions like this. # in this example, we override the template to only keep 12 hourly and 1 monthly snapshot for this dataset. # hourly = 12 # monthly = 1 # you can also handle datasets recursively. #[zpoolname/parent] # use_template = production # recursive = yes # if you want sanoid to manage the child datasets but leave this one alone, set process_children_only. # process_children_only = yes # you can selectively override settings for child datasets which already fall under a recursive definition. #[zpoolname/parent/child] # child datasets already initialized won't be wiped out, so if you use a new template, it will # only override the values already set by the parent template, not replace it completely. # use_template = demo [bytor/tnfs] use_template = production recursive = yes ############################# # templates below this line # ############################# # name your templates template_templatename. you can create your own, and use them in your module definitions above. [template_demo] daily = 60 [template_production] frequently = 10 hourly = 36 daily = 30 monthly = 3 yearly = 3 autosnap = yes List snapshots This is after about an hour or so pi@tnfspi:~$ zfs list -t snapshot bytor/tnfs NAME USED AVAIL REFER MOUNTPOINT bytor/tnfs@autosnap_2021-12-27_13:00:04_yearly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_monthly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_daily 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_hourly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:15:13_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:30:19_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:45:06_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_14:00:22_hourly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_14:00:22_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_14:15:00_frequently 0B - 24K - Access snapshots pi@tnfspi:~$ ls /bytor/tnfs/.zfs/snapshot autosnap_2021-12-27_13:00:04_daily autosnap_2021-12-27_13:00:04_monthly autosnap_2021-12-27_13:30:19_frequently autosnap_2021-12-27_14:00:22_hourly autosnap_2021-12-27_13:00:04_frequently autosnap_2021-12-27_13:00:04_yearly autosnap_2021-12-27_13:45:06_frequently autosnap_2021-12-27_14:15:00_frequently autosnap_2021-12-27_13:00:04_hourly autosnap_2021-12-27_13:15:13_frequently autosnap_2021-12-27_14:00:22_frequently This page under construction","title":"ZFS"},{"location":"zfs/#zfs","text":"","title":"ZFS"},{"location":"zfs/#_1","text":"Installation of the ZFS filesystem is optional and requires the Ubuntu 64bit operating system.","title":"&nbsp;"},{"location":"zfs/#install-zfsutils-linux","text":"pi@tnfspi:~$ sudo apt install zfsutils-linux","title":"Install zfsutils-linux"},{"location":"zfs/#create-zpool-on-zdata-partition","text":"pi@tnfspi:~$ sudo zpool create bytor -f -d /dev/disk/by-label/zdata pi@tnfspi:~$ sudo zpool upgrade bytor","title":"Create zpool on zdata partition"},{"location":"zfs/#create-tnfs-zfs-dataset","text":"pi@tnfspi:~$ sudo zfs create -o atime=off -o compression=lz4 -o recordsize=1k bytor/tnfs limit zfs memory cache to 1GB","title":"Create tnfs zfs dataset"},{"location":"zfs/#_2","text":"pi@tnfspi:~$ sudo echo \"options zfs zfs_arc_max=1073741824\"|sudo tee -a /etc/modprobe.d/zfs.conf","title":""},{"location":"zfs/#install-sanoid","text":"pi@tnfspi:~$ sudo apt install sanoid pi@tnfspi:~$ sudo mkdir /etc/sanoid pi@tnfspi:~$ sudo cp /usr/share/doc/sanoid/examples/sanoid.conf /etc/sanoid/sanoid.conf","title":"Install sanoid"},{"location":"zfs/#edit-sanoid-config-file","text":"pi@tnfspi:~$ sudo nano /etc/sanoid/sanoid.conf Comment out all examples, add single entry for bytor/tnfs Modify template_production frequently=10 and yearly=3 ###################################### # This is a sample sanoid.conf file. # # It should go in /etc/sanoid. # ###################################### # name your backup modules with the path to their ZFS dataset - no leading slash. #[zpoolname/datasetname] # pick one or more templates - they're defined (and editable) below. Comma separated, processed in order. # in this example, template_demo's daily value overrides template_production's daily value. # use_template = production,demo # if you want to, you can override settings in the template directly inside module definitions like this. # in this example, we override the template to only keep 12 hourly and 1 monthly snapshot for this dataset. # hourly = 12 # monthly = 1 # you can also handle datasets recursively. #[zpoolname/parent] # use_template = production # recursive = yes # if you want sanoid to manage the child datasets but leave this one alone, set process_children_only. # process_children_only = yes # you can selectively override settings for child datasets which already fall under a recursive definition. #[zpoolname/parent/child] # child datasets already initialized won't be wiped out, so if you use a new template, it will # only override the values already set by the parent template, not replace it completely. # use_template = demo [bytor/tnfs] use_template = production recursive = yes ############################# # templates below this line # ############################# # name your templates template_templatename. you can create your own, and use them in your module definitions above. [template_demo] daily = 60 [template_production] frequently = 10 hourly = 36 daily = 30 monthly = 3 yearly = 3 autosnap = yes","title":"Edit sanoid config file"},{"location":"zfs/#list-snapshots","text":"This is after about an hour or so pi@tnfspi:~$ zfs list -t snapshot bytor/tnfs NAME USED AVAIL REFER MOUNTPOINT bytor/tnfs@autosnap_2021-12-27_13:00:04_yearly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_monthly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_daily 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_hourly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:00:04_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:15:13_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:30:19_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_13:45:06_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_14:00:22_hourly 0B - 24K - bytor/tnfs@autosnap_2021-12-27_14:00:22_frequently 0B - 24K - bytor/tnfs@autosnap_2021-12-27_14:15:00_frequently 0B - 24K -","title":"List snapshots"},{"location":"zfs/#access-snapshots","text":"pi@tnfspi:~$ ls /bytor/tnfs/.zfs/snapshot autosnap_2021-12-27_13:00:04_daily autosnap_2021-12-27_13:00:04_monthly autosnap_2021-12-27_13:30:19_frequently autosnap_2021-12-27_14:00:22_hourly autosnap_2021-12-27_13:00:04_frequently autosnap_2021-12-27_13:00:04_yearly autosnap_2021-12-27_13:45:06_frequently autosnap_2021-12-27_14:15:00_frequently autosnap_2021-12-27_13:00:04_hourly autosnap_2021-12-27_13:15:13_frequently autosnap_2021-12-27_14:00:22_frequently This page under construction","title":"Access snapshots"}]}